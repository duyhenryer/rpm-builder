[Unit]
Description=Micro Platform - API Server
After=micro-platform-infra.target
Requires=micro-platform-infra.target
PartOf=micro-platform-all.target

[Service]
Type=exec
User=nobody
Group=nobody
WorkingDirectory=/opt/micro-platform/apps/api-server

# Load shared configurations first
EnvironmentFile=/opt/micro-platform/apps/conf-shared/env.properties
EnvironmentFile=/opt/micro-platform/apps/conf-shared/redis.properties

# Load app-specific configuration (can override shared)
EnvironmentFile=/opt/micro-platform/apps/api-server/api-server.properties

# Optional override file (won't fail if missing)
EnvironmentFile=-/opt/micro-platform/apps/api-server/api-server.override

ExecStart=/opt/micro-platform/apps/api-server/api-server
Restart=always
RestartSec=10
StandardOutput=append:/var/log/micro-platform/api-server/stdout.log
StandardError=append:/var/log/micro-platform/api-server/stderr.log
# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=full
ProtectHome=true
ReadWritePaths=/var/log/micro-platform/api-server

[Install]
WantedBy=multi-user.target

